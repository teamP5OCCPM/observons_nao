{% extends 'base.html.twig' %}

{% block title %}
    {{ observation.title }} - {{ parent() }}
{% endblock %}

{% block body %}
    <div class="container mt70">
        <div class="d-flex flex-wrap justify-content-between mb-3">
            <div>
                <h2>{{ observation.title }}</h2>
                <p class="text-muted">{{ observation.user.username }} | {{ observation.observedAt | date("d/m/Y") }} | <span id="location"></span></p>
            </div>
            <a href="{{ path('addObservation') }}" class="btn btn-secondary btn-sm cta-small">Proposer une observation</a>
        </div>
        <div class="clearfix"></div>
        <div class="card justify-content-around">
            <div class="card-body d-flex flex-wrap">
                <div class="col-md-6">
                    <div class="show-box-img">
                        <img class="card-img-top" src="{{ asset("img/observations/" ~ observation.imageName) }}" alt="">
                        <div class="share-box">
                            <p class="text-center">Partagez cette observation</p>
                            <div class="row pb-1 justify-content-center">
                                <span><a href="http://facebook.com"><i class="fa fa-facebook-square fa-2x mr-2" aria-hidden="true"></i></a></span>
                                <span><a href="http://twitter.com"><i class="fa fa-twitter-square fa-2x mr-2" aria-hidden="true"></i></a></span>
                                <span><a href="http://plus.google.com"><i class="fa fa-google-plus-square fa-2x" aria-hidden="true"></i></a></span>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="col-md-6">
                    <p class="text-muted">{{ observation.bird.species }} | Ordre : {{ observation.bird.ranking }}
                        | Famille : {{ observation.bird.family }}
                    </p>
                    <p class="card-text">{{ observation.description }}</p>
                </div>
            </div>
        </div>
        <h2>Géolocalisation</h2>
        <div id="map" class="google-map"></div>
        <div class="d-flex justify-content-between flex-wrap mt-5 mb-3">
            <h2>De la même espèce</h2>
            <a href="{{ path('observations', {'page': 1}) }}" class="btn btn-secondary btn-sm cta-small">Consulter plus d'observations</a>
        </div>
        <div class="row">
            <div class="col-md-6 col-lg-4 col-xl-3">
                <div class="card hoverable">
                    <div class="img-card-box">
                        <img class="card-img-top" src="{{ asset('img/birds-eagle-animal.jpg') }}" alt="Card image cap">
                    </div>
                    <div class="card-body">
                        <a href="#">
                            <h4 class="text-center">Titre de l'observation</h4>
                        </a>
                        <p class="text-center">Auteur - le xx/xx/xxxx</p>
                    </div>
                </div>
            </div>
            <div class="col-md-6 col-lg-4 col-xl-3">
                <div class="card hoverable">
                    <div class="img-card-box">
                        <img class="card-img-top" src="{{ asset('img/birds-eagle-animal.jpg') }}" alt="Card image cap">
                    </div>
                    <div class="card-body">
                        <a href="#">
                            <h4 class="text-center">Titre de l'observation</h4>
                        </a>
                        <p class="text-center">Auteur - le xx/xx/xxxx</p>
                    </div>
                </div>
            </div>
            <div class="col-md-6 col-lg-4 col-xl-3">
                <div class="card hoverable">
                    <div class="img-card-box">
                        <img class="card-img-top" src="{{ asset('img/birds-eagle-animal.jpg') }}" alt="Card image cap">
                    </div>
                    <div class="card-body">
                        <a href="#">
                            <h4 class="text-center">Titre de l'observation</h4>
                        </a>
                        <p class="text-center">Auteur - le xx/xx/xxxx</p>
                    </div>
                </div>
            </div>
            <div class="col-md-6 col-lg-4 col-xl-3">
                <div class="card hoverable">
                    <div class="img-card-box">
                        <img class="card-img-top" src="{{ asset('img/birds-eagle-animal.jpg') }}" alt="Card image cap">
                    </div>
                    <div class="card-body">
                        <a href="#">
                            <h4 class="text-center">Titre de l'observation</h4>
                        </a>
                        <p class="text-center">Auteur - le xx/xx/xxxx</p>
                    </div>
                </div>
            </div>
        </div>
    </div>
{% endblock %}

{% block javascript %}
{{ parent() }}
    <script>
        function initMap() {
            const position = {lat: {{ observation.lat }}, lng: {{ observation.lng }} };
            const map = new google.maps.Map(document.getElementById('map'), {
                zoom: 11,
                center: position
            });
            const marker = new google.maps.Marker({
                position: position,
                map: map
            });

            const geocoder = new google.maps.Geocoder;
            geocodeLatLng(geocoder);
        }

        // Décode lat et lng en adresse
        function geocodeLatLng(geocoder) {
            geocoder.geocode({'location': {lat: {{ observation.lat }}, lng: {{ observation.lng }} }}, function(results, status) {
                if (status === "OK") {
                    const locationBox = document.querySelector('#location');
                    const town = results[2].address_components[1].long_name // récupère la ville
                    locationBox.append(town);
                    console.log(town);
                } else {
                    window.alert('La ville n\'a pas été récupérée : ' + status);
                }
            });
        }
    </script>
{% endblock %}
